From 23ed1af481aa4a2901887a3127d42cf398fd40f5 Mon Sep 17 00:00:00 2001
From: Brooks Prumo <brooks@prumo.org>
Date: Fri, 15 Jan 2016 17:19:47 -0600
Subject: [PATCH 03/21] uhd: add CMake flag for the Windows registry key to
 specify UHD images directory

---
 host/CMakeLists.txt      | 6 +++---
 host/lib/utils/paths.cpp | 8 ++------
 2 files changed, 5 insertions(+), 9 deletions(-)

diff --git a/host/CMakeLists.txt b/host/CMakeLists.txt
index 8953e83..6ac281c 100644
--- a/host/CMakeLists.txt
+++ b/host/CMakeLists.txt
@@ -75,9 +75,9 @@ OPTION(UHD_IMAGES_DIR "Path to installed UHD image binaries.")
 MESSAGE( STATUS "Using UHD Images Directory: ${UHD_IMAGES_DIR}" )
 ADD_DEFINITIONS(-DUHD_IMAGES_DIR=${UHD_IMAGES_DIR})
 
-IF(DEFINED USE_NIUSRP_WINREG_KEY)
-    ADD_DEFINITIONS(-DUSE_NIUSRP_WINREG_KEY)
-ENDIF(DEFINED USE_NIUSRP_WINREG_KEY)
+IF(DEFINED UHD_IMAGES_DIR_WINREG_KEY)
+    ADD_DEFINITIONS(-DUHD_IMAGES_DIR_WINREG_KEY=${UHD_IMAGES_DIR_WINREG_KEY})
+ENDIF(DEFINED UHD_IMAGES_DIR_WINREG_KEY)
 
 ########################################################################
 # Local Include Dir
diff --git a/host/lib/utils/paths.cpp b/host/lib/utils/paths.cpp
index eb9e69a..ebc18fe 100644
--- a/host/lib/utils/paths.cpp
+++ b/host/lib/utils/paths.cpp
@@ -41,10 +41,6 @@
 #include <windows.h> //GetTempPath
 #endif
 
-#ifdef USE_NIUSRP_WINREG_KEY
-#define NIUSRP_WINREG_KEY "[HKLM\\Software\\National Instruments\\NI-USRP\\DriverBitfilesDir]"
-#endif
-
 namespace fs = boost::filesystem;
 
 /*! Get the value of an environment variable.
@@ -287,8 +283,8 @@ std::string uhd::get_images_dir(const std::string &search_paths) {
      * (see below). Making a local copy for const correctness. */
     std::string _search_paths = search_paths;
 
-#ifdef USE_NIUSRP_WINREG_KEY
-    _search_paths = std::string(NIUSRP_WINREG_KEY) + "," + search_paths;
+#ifdef UHD_IMAGES_DIR_WINREG_KEY
+    _search_paths = std::string("UHD_IMAGES_DIR_WINREG_KEY") + "," + search_paths;
 #endif
 
     /* Now we will parse and attempt to qualify the paths in the `search_paths`
-- 
2.1.4

