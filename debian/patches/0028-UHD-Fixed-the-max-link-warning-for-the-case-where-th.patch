From fdec0138c8b17a71b541cfadae38de9743890416 Mon Sep 17 00:00:00 2001
From: Paul David <paul.david@ettus.com>
Date: Mon, 6 Jun 2016 13:45:31 -0700
Subject: [PATCH 28/30] UHD: Fixed the max link warning for the case where
 there are multiple motherboards

---
 host/lib/usrp/multi_usrp.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/host/lib/usrp/multi_usrp.cpp b/host/lib/usrp/multi_usrp.cpp
index 396237e..4540889 100644
--- a/host/lib/usrp/multi_usrp.cpp
+++ b/host/lib/usrp/multi_usrp.cpp
@@ -1666,6 +1666,7 @@ private:
 
     //! \param is_tx True for tx
     // Assumption is that all mboards use the same link
+    // and that the rate sum is evenly distributed among the mboards
     bool _check_link_rate(const stream_args_t &args, bool is_tx) {
         bool link_rate_is_ok = true;
         size_t bytes_per_sample = convert::get_bytes_per_item(args.otw_format.empty() ? "sc16" : args.otw_format);
@@ -1681,6 +1682,7 @@ private:
             }
             sum_rate += is_tx ? get_tx_rate(chan) : get_rx_rate(chan);
         }
+        sum_rate /= get_num_mboards();
         if (max_link_rate > 0 and (max_link_rate / bytes_per_sample) < sum_rate) {
             UHD_MSG(warning) << boost::format(
                 "The total sum of rates (%f MSps on %u channels) exceeds the maximum capacity of the connection.\n"
-- 
2.1.4

